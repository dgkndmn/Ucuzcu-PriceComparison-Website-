{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <title>Find Your Price</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
</head>
<body>

    <style>
        body{
          background-color: #FFEEEE;
          padding-top: 125px;
        }
        
        a {
          color: black;
          text-decoration: none;
        }
        
        .d-flex{
          justify-content:center;
        }

        .navbar-brand{
            margin-left:15px;
        }

        .collapse.navbar-collapse {
            justify-content:center;
            
        }

        .form-control.me-2 {
            margin-top:15px;
            width: 700px;
            height:50px;
        }

        .btn.btn-outline-primary {
            margin-top: 15px;
            height: 50px;
            width:80px;
        }


        .containerdeneme {
            margin-top: 15px;
            justify-content: right;
            margin-right: 20px;
        }

        .card.mb-3{
            background-color: #D7D0D0;
            width: 800px;
            height: 300px;
            margin: 0 auto;
            margin-top: 10px;
            overflow: hidden;
            display: block;
        }

        .col-md-4{
            background-color: #D7D0D0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            border: 0.5px solid #000;
            
            
        }

        .img-fluid.rounded-start{
            max-width: 100%;
            height: 100%;
            object-fit: fill;
        }

        .card-price{
          font-size:30px;
          text-align:center;
          margin-right:7px;
          margin-top: 50px;
        }

        .btn.btn-primary{
          background-color: #ffffff;
          color: #000000;
          text-align: center;
          font-family: Roboto;
          font-size: 20px;
          width:250px;
        }

        .shoppingcart{
          height: 20px;
          width: 20px;
          margin-right:10px;
          margin-bottom:3px;
        }

        .card-title{
          font-family: Roboto;
        }

        .card-text{
          font-family: Roboto;
        }

        .loggeduser{
            margin-right:180px;
        }

        .navbar.navbar-expand-lg.fixed-top{
            padding-left:35px;
        }
        
        .dropdown-menu {
            top: 100%;
            right: 30;
        }


    </style>

    <nav class="navbar navbar-expand-lg fixed-top" style="background-color: #e3f2fd;" data-bs-theme="light">
        <div class="container-fluid">
            <div class="d-flex flex-column align-items-center" style="margin-left:10px;">
                <a href="{% url 'pricewebsiteapp:home' %}"><img src="{% static 'shopbag.svg' %}" style="width: 40px; height:40px;" href="{% url 'pricewebsiteapp:home' %}"></a>
                <a class="navbar-brand" href="{% url 'pricewebsiteapp:home' %}" style="font-family:'AppleGothic';font-size:25px;letter-spacing: 2px;"><b>ucuzcu</b></a>
            </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor03" aria-controls="navbarColor03" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarColor03">
            <form class="d-flex" method="GET" role="search" action="{% url 'pricewebsiteapp:product_view' %}" style="margin-left:160px;">
              <input class="form-control me-2" name="q" type="search" placeholder="Aramak istediğin ürünü gir" aria-label="Search">
              <button class="btn btn-outline-primary" type="submit">Ara</button>
            </form>
          </div>
        </div>

        {% if not user.is_authenticated %}
        <div class="containerdeneme">
            <div class="d-flex flex-row align-items-center">
                <div class="d-flex flex-column align-items-center mx-2">
                    <a href="{% url 'pricewebsiteapp:signup' %}">
                        <img src="{% static 'signupicon.svg' %}" style="width: 30px; height:30px;">
                    </a>
                    <a class="navbar-brand" href="{% url 'pricewebsiteapp:signup' %}" style="font-family:'Roboto';font-size:24px;">kayıt ol</a>
                </div>
                <div class="d-flex flex-column align-items-center mx-3">
                    <a href="{% url 'login' %}">
                        <img src="{% static 'loginkey.svg' %}" style="width: 30px; height:30px;">
                    </a>
                    <a class="navbar-brand" href="{% url 'login' %}" style="font-family:'Roboto';font-size:24px;">giriş yap</a>
                </div>
            </div>
        </div>
        {%else%}
        <div class="loggeduser">
        <img class="personphoto" src="{% static 'person.svg' %}" style="width:35px;height:35px;margin-left:190px;">
        <div class="dropdown">
            <h5 class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="cursor: pointer;font-family:'Roboto'; margin-left:170px;padding-top:5px;">
              {{user.username}}
            </h5>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="{% url 'pricewebsiteapp:favourites'%}">Favorilerim</a></li>
              <li><a class="dropdown-item" href="{% url 'pricewebsiteapp:changepassword' %}">Şifre Değiştir</a></li>
              <li><a class="dropdown-item" href="{% url 'logout' %}">Çıkış Yap</a></li>
            </ul>
          </div>
        </div>
        {%endif%}
      </nav>

    {% block content %}

    {% for urun in all_products %}
    {% if urun and urun.id %}
      {% if urun.site == "Trendyol" and urun.name and urun.price and urun.image_url and urun.link %}
        <div class="card mb-3">
          <div class="row g-0">
            <div class="col-md-4">
              <img src="{{ urun.image_url }}" class="img-fluid rounded-start" alt="{{ urun.name }}">
            </div>
            <div class="col-md-8">
              <div class="card-body">
                {% if user.is_authenticated %}
                  {% if urun.is_favourite %}
                    <form method="POST" action="{% url 'pricewebsiteapp:remove_from_favourites' urun.id %}">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-danger favourite" style="margin-left: 400px; height: 60px; width: 100px; font-family: Roboto; font-size:16px;">Favorilerden Kaldır</button>
                    </form>
                  {% else %}
                    <form method="POST" action="{% url 'pricewebsiteapp:add_to_favourites' urun.id %}">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-warning favourite" style="margin-left: 400px; height: 60px; width: 100px; font-family: Roboto; font-size:16px;">Favorilere Ekle</button>
                    </form>
                  {% endif %}
                {% endif %}
                <a href="{{urun.link}}"><h5 class="card-title">{{ urun.name }}</h5></a>
                <p class="card-text"><small class="text-body-secondary">Aradığınız ürünün Trendyol'daki fiyatı aşağıdaki gibidir.</small></p>
                <h5 class="card-price">{{ urun.price }} ₺</h5>
                <div class="d-grid gap-2 col-6 mx-auto">
                  <a href="{{urun.link}}">
                    <button class="btn btn-primary" type="button">
                      <img src="{% static "shopping.svg" %}" class="shoppingcart">Ürüne Git
                    </button>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endif %}
{%else%}
{% endif %}
  {% endfor %}
  
  {% for urun in all_products %}
  {% if urun and urun.id %}
    {% if urun.site == "Teknosa" and urun.name and urun.price and urun.image_url and urun.link %}
      <div class="card mb-3">
        <div class="row g-0">
          <div class="col-md-4">
            <img src="{{ urun.image_url }}" class="img-fluid rounded-start" alt="{{ urun.name }}">
          </div>
          <div class="col-md-8">
            <div class="card-body">
              {% if user.is_authenticated %}
                {% if urun.is_favourite %}
                  <form method="POST" action="{% url 'pricewebsiteapp:remove_from_favourites' urun.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger favourite" style="margin-left: 400px; height: 60px; width: 100px; font-family: Roboto; font-size:16px;">Favorilerden Kaldır</button>
                  </form>
                {% else %}
                  <form method="POST" action="{% url 'pricewebsiteapp:add_to_favourites' urun.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-warning favourite" style="margin-left: 400px; height: 60px; width: 100px; font-family: Roboto; font-size:16px;">Favorilere Ekle</button>
                  </form>
                {% endif %}
              {% endif %}
              <a href="{{urun.link}}"><h5 class="card-title">{{ urun.name }}</h5></a>
              <p class="card-text"><small class="text-body-secondary">Aradığınız ürünün Teknosa'daki fiyatı aşağıdaki gibidir.</small></p>
              <h5 class="card-price">{{ urun.price }} ₺</h5>
              <div class="d-grid gap-2 col-6 mx-auto">
                <a href="{{urun.link}}">
                  <button class="btn btn-primary" type="button">
                    <img src="{% static "shopping.svg" %}" class="shoppingcart">Ürüne Git
                  </button>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
{%else%}

  {% endif %}
{% endfor %}

   
      
{% for urun in all_products %}
{% if urun and urun.id %}
  {% if urun.site == "Mediamarkt" and urun.name and urun.price and urun.image_url and urun.link %}
    <div class="card mb-3">
      <div class="row g-0">
        <div class="col-md-4">
          <img src="{{ urun.image_url }}" class="img-fluid rounded-start" alt="{{ urun.name }}">
        </div>
        <div class="col-md-8">
          <div class="card-body">
            {% if user.is_authenticated %}
              {% if urun.is_favourite %}
                <form method="POST" action="{% url 'pricewebsiteapp:remove_from_favourites' urun.id %}">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger favourite" style="margin-left: 400px; height: 60px; width: 100px; font-family: Roboto; font-size:16px;">Favorilerden Kaldır</button>
                </form>
              {% else %}
                <form method="POST" action="{% url 'pricewebsiteapp:add_to_favourites' urun.id %}">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-warning favourite" style="margin-left: 400px; height: 60px; width: 100px; font-family: Roboto; font-size:16px;">Favorilere Ekle</button>
                </form>
              {% endif %}
            {% endif %}
            <a href="{{urun.link}}"><h5 class="card-title">{{ urun.name }}</h5></a>
            <p class="card-text"><small class="text-body-secondary">Aradığınız ürünün Mediamarkt'daki fiyatı aşağıdaki gibidir.</small></p>
            <h5 class="card-price">{{ urun.price }} ₺</h5>
            <div class="d-grid gap-2 col-6 mx-auto">
              <a href="{{urun.link}}">
                <button class="btn btn-primary" type="button">
                  <img src="{% static "shopping.svg" %}" class="shoppingcart">Ürüne Git
                </button>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
{%else%}

{% endif %}
{% endfor %}

    
{% for urun in all_products %}
{% if urun and urun.id %}
  {% if urun.site == "Hepsiburada" and urun.name and urun.price and urun.image_url and urun.link %}
    <div class="card mb-3">
      <div class="row g-0">
        <div class="col-md-4">
          <img src="{{ urun.image_url }}" class="img-fluid rounded-start" alt="{{ urun.name }}">
        </div>
        <div class="col-md-8">
          <div class="card-body">
            {% if user.is_authenticated %}
              {% if urun.is_favourite %}
                <form method="POST" action="{% url 'pricewebsiteapp:remove_from_favourites' urun.id %}">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger favourite" style="margin-left: 400px; height: 60px; width: 100px; font-family: Roboto; font-size:16px;">Favorilerden Kaldır</button>
                </form>
              {% else %}
                <form method="POST" action="{% url 'pricewebsiteapp:add_to_favourites' urun.id %}">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-warning favourite" style="margin-left: 400px; height: 60px; width: 100px; font-family: Roboto; font-size:16px;">Favorilere Ekle</button>
                </form>
              {% endif %}
            {% endif %}
            <a href="{{urun.link}}"><h5 class="card-title">{{ urun.name }}</h5></a>
            <p class="card-text"><small class="text-body-secondary">Aradığınız ürünün Hepsiburada'daki fiyatı aşağıdaki gibidir.</small></p>
            <h5 class="card-price">{{ urun.price }} ₺</h5>
            <div class="d-grid gap-2 col-6 mx-auto">
              <a href="{{urun.link}}">
                <button class="btn btn-primary" type="button">
                  <img src="{% static "shopping.svg" %}" class="shoppingcart">Ürüne Git
                </button>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
{%else%}

{% endif %}
{% endfor %}

{% if message %}

<img src="{% static 'failed.svg' %}" style="width:300px;height:300px; margin-left:600px;">
<h2 style="text-align: center;margin-top:50px; font-family: Roboto;">{{message}}</h2>
{% endif %}

{%endblock%}

  

<script>
  document.addEventListener('DOMContentLoaded', function() {
      if (window.location.pathname === '/') {
        document.addEventListener('DOMContentLoaded', function() {
          const buttons = document.querySelectorAll('.favourite');
      
          buttons.forEach(button => {
              button.addEventListener('click', function(event) {
                  event.preventDefault();
                  const form = this.closest('form');
                  const actionUrl = form.action;
                  const formData = new FormData(form);
      
                  fetch(actionUrl, {
                      method: 'POST',
                      headers: {
                          'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                      },
                      body: new URLSearchParams(formData)
                  }).then(response => {
                      if (response.ok) {
                          const btn = button;
                          if (btn.textContent.includes('Favorilere Ekle')) {
                              btn.textContent = 'Favorilerden Kaldır';
                              btn.classList.remove('btn-warning');
                              btn.classList.add('btn-danger');
                          } else {
                              btn.textContent = 'Favorilere Ekle';
                              btn.classList.remove('btn-danger');
                              btn.classList.add('btn-warning');
                          }
                      } else {
                          console.error('Fetch request failed');
                      }
                  }).catch(error => console.error('Fetch error:', error));
              });
          });
      });
          console.log('Home sayfasında çalışıyor.');
      } else {
         
      }
  });
</script>


    
</body>
</html>